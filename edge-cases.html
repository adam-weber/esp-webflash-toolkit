<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edge Cases - ESP WebFlash Toolkit</title>
    <link rel="stylesheet" href="shared-styles.css">
    <script>
        // Apply dark mode immediately to prevent flash
        (function() {
            const savedMode = localStorage.getItem('darkMode');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (savedMode === 'dark' || (!savedMode && prefersDark)) {
                document.documentElement.classList.add('dark-mode');
            }
        })();
    </script>
    <link rel="stylesheet" href="docs-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
</head>
<body>
    <div id="navbar-container"></div>

    <nav class="sidebar">
        <!-- Sidebar content will be dynamically generated by docs-sidebar.js -->
    </nav>

    <div class="container">
        <div id="details" class="lesson">
            <h2>Implementation Details</h2>
            <p class="lesson-intro">Namespace management, binary blob handling, partition sizing considerations, format limitations.</p>

            <h3>Multiple Namespace Support</h3>
            <p>Top-level object keys define separate namespaces. Namespace isolation allows key name collisions without conflict:</p>

            <pre><code class="language-javascript">const config = {
    wifi: { ssid: "MyNetwork", password: "SecurePass" },
    mqtt: { broker: "192.168.1.100", port: 1883 },
    calibration: { temp_offset: -2.5, enabled: true }
};

const nvs = generator.generate(config, 0x6000);</code></pre>

            <h3>Binary Blob Storage</h3>
            <p>Uint8Array values are encoded as blob entries. Blobs exceeding 8 bytes are chunked across multiple entries:</p>

            <pre><code class="language-javascript">const cert = await fetch('cert.pem').then(r => r.arrayBuffer());

const config = {
    security: {
        device_cert: new Uint8Array(cert),  // ~4KB maximum
        device_id: "ESP32-001"
    }
};

const nvs = generator.generate(config, 0x6000);</code></pre>

            <div class="callout">
                <div class="callout-title">Blob Size Limitations</div>
                <div class="callout-body">Maximum blob size in V1 format: approximately 4000 bytes. Constraint origin: 126 entries per page, uint8 span field. For data exceeding 4KB, alternative approaches include SPIFFS storage with NVS filename references.</div>
            </div>

            <h3>Partition Size Requirements</h3>
            <p>Partition sizes must be multiples of 4096 bytes. Larger partitions provide increased wear-leveling headroom at the cost of reduced usable flash capacity:</p>

            <div class="grid-2" style="grid-template-columns: 1fr 1fr 1fr;">
                <div class="card">
                    <h4>0x3000 (12KB)</h4>
                    <p>3 pages, ~30-40 pairs</p>
                </div>
                <div class="card">
                    <h4>0x6000 (24KB)</h4>
                    <p>6 pages, ~60-80 pairs</p>
                </div>
                <div class="card">
                    <h4>0x10000 (64KB)</h4>
                    <p>16 pages, ~160-200 pairs</p>
                </div>
            </div>
        </div>
    </div>

    <script src="shared-nav.js"></script>
    <script src="docs-scripts.js"></script>
    <script src="docs-sidebar.js"></script>
</body>
</html>
